<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:jsf="http://xmlns.jcp.org/jsf"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        template="/WEB-INF/layout/public.xhtml">
    <ui:define name="body">

        <h:form prependId="false" id="trackingForm" styleClass="row row-cols-lg-auto g-3 align-items-center">
            <div class="col-12">
                <label class="visually-hidden" for="trackingIdInput">Enter your tracking ID:</label>
                <input type="text" jsf:id="trackingIdInput"
                       class="form-control"
                       jsf:value="#{track.trackingId}"
                       jsf:required="true"
                       placeholder="Enter Tracking ID, eg.XYZ789"/>
            </div>
            <div class="col-12">
                <button class="btn btn-primary"
                        jsf:action="#{track.onTrackById()}">
                    Track!
                </button>
            </div>
        </h:form>

        <ui:fragment rendered="#{not empty track.cargo}">
            <div class="row g-3 my-5 me-3">
                <div class="col-12 col-md-6">
                    <p>
                        Cargo <strong>#{track.cargo.trackingId}</strong> is
                        currently <strong>#{track.cargo.statusText}</strong>
                    </p>

                    <p>
                        Estimated time of arrival in <strong>#{track.cargo.destinationName}</strong>:
                        #{track.cargo.eta}
                    </p>
                    <ui:fragment
                            rendered="#{not empty track.cargo.nextExpectedActivity}">
                        <p>#{track.cargo.nextExpectedActivity}</p>
                    </ui:fragment>

                    <ui:fragment rendered="#{track.cargo.misdirected}">
                        <p class="text-danger">
                            <i class="bi bi-x-circle text-danger"></i>
                            Cargo is misdirected.
                        </p>
                    </ui:fragment>
                    <h3 class="my-2 fs-3">Handling History </h3>

                    <ui:fragment rendered="#{empty track.cargo.events}">
                        <p>
                            There are no events recorded for the tracking ID #{track.cargo.trackingId}."
                        </p>
                    </ui:fragment>


                    <ui:repeat value="#{track.cargo.events}" var="leg">
                        <div>
                            <ui:fragment rendered="#{leg.expected}">
                                <i class="bi bi-check-circle text-success me-1"></i>#{leg.description}, at #{leg.time}
                            </ui:fragment>
                            <ui:fragment rendered="#{!leg.expected}">
                                <i class="bi bi-x-circle text-danger me-1"></i>#{leg.description}, at #{leg.time}
                            </ui:fragment>
                        </div>
                    </ui:repeat>
                </div>
                <div class="col-12 col-md-6">
                    <iframe class="mapFrame" width="100%" height="960" frameBorder="0"
                            src="#{request.contextPath}/public/mapFrame.xhtml?statusCode=#{track.cargo.statusCode}&amp;lastKnownLocationCode=#{track.cargo.lastKnownLocationCode}&amp;lastKnownLocationName=#{track.cargo.lastKnownLocationName}&amp;originCode=#{track.cargo.originCode}&amp;originName=#{track.cargo.originName}&amp;destinationCode=#{track.cargo.destinationCode}&amp;destinationName=#{track.cargo.destinationName}"/>
                </div>
            </div>
        </ui:fragment>
    </ui:define>
</ui:composition>
